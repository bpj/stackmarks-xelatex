\usepackage{xparse}
\usepackage{calc}

\newlength{\loMarkRaiseAdjust}
\newlength{\hiMarkRaiseAdjust}
\newlength{\markItalicAdjust}
\setlength{\loMarkRaiseAdjust}{1ex*-1/100}
\setlength{\hiMarkRaiseAdjust}{1ex*-1/100}
\newlength{\loMarkRaise}
\newlength{\hiMarkRaise}
\newlength{\markKern}
\newsavebox{\markBox}
\NewDocumentCommand\makeMarkBox{%
    m   %   #1  base
    m   %   #2  mark
    m   %   #3  markbase
    m   %   #4  raise
}{%
    \leavevmode%
    \protect\makebox[0em][c]{%
        \protect\makebox[\widthof{#1}][c]{%
            \protect\raisebox{#4}{%
                \protect\makebox[\widthof{#3}][r]{#2}%
            }%
        }%
    }%
}%
\NewDocumentCommand\stackMark{%
    s           %   #1  base is high letter
    D<>{r}      %   #2  box for marks is as wide as this
    m           %   #3  base/letter
    s           %   #4  italic compensation
    d<>         %   #5  base letter without mark
    O{-0.01ex}  %   #7  mark raise adjustment
    m       %   #6  higher mark
}{%
    \leavevmode%
    \setlength{\hiMarkRaise}{\heightof{#5}-\heightof{#2}}%
    \setlength{\hiMarkRaise}{\hiMa}%
    \IfBooleanTF{#1}{%
        \addtolength{\loMarkRaise}{\heightof{#3}-\heightof{#2}}%
        \setlength{\hiMarkRaise}{\heightof{#6}-\heightof{#2}}%
    }%
    \setlength{\markKern}{\widthof{#3}/2}%
    #3%
    \kern-\markKern%
    \makeMarkBox{#2}{#6}{#2}{\hiMarkRaise}%
    \kern\markKern%
}%
